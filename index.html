<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fast Print Service - Upload & Estimate</title>
    <link rel="stylesheet" href="styles.css">
</head>

 <body>
    <!--<div class="overlay"> -->
        <div class="container">
            <header>
                <h1>Fast Print Service</h1>
                <p>Upload your document, get a quick estimate, and place your order!</p>
            </header>

            <section class="upload-section">
                <h2>Upload Your Document</h2>
                <form id="uploadForm" action="upload.php" method="POST" enctype="multipart/form-data">
                    <!-- Name and Mobile Number Fields -->
                    <div class="input-group">
                        <label for="customerName">Your Name</label>
                        <input type="text" id="customerName" name="customerName" placeholder="Enter your name" required>
                    </div>

                    <div class="input-group">
                        <label for="customerMobile">Your Mobile Number</label>
                        <input type="text" id="customerMobile" name="customerMobile" placeholder="Enter your mobile number" required>
                    </div>

                    <div class="input-group">
                        <label for="fileUpload">Choose a File (PDF, Word, or Image)</label>
                        <input type="file" id="fileUpload" name="fileUpload" accept=".pdf, .docx, .jpg, .jpeg, .png" required>
                    </div>

                    <div class="input-group">
                        <label for="printType">Print Type</label>
                        <select id="printType" name="printType" required>
                            <option value="bw">Black & White</option>
                            <option value="color">Color</option>
                        </select>
                        
                    </div>

                    <div class="input-group">
                        <label for="delivery">Delivery Option</label>
                        <select id="delivery" name="delivery" required>
                            <option value="delivery">Home Delivery</option>
                            <option value="counter">Counter Collection</option>
                        </select>
                    </div>

                    <button type="button" id="estimateBtn" class="btn">Get Price Estimate</button>
                    <!-- Updated Feedback Section -->
                    <div id="estimateResult"></div>

                    <button type="submit" class="btn submit-btn">Submit Order</button>
                </form>
            </section>
<section class="admin-section">
    <a href="shop_owner.php" class="btn admin-btn">Shop Owner</a>
</section>
        </div>
    </div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const estimateBtn = document.getElementById('estimateBtn');
        const submitForm = document.getElementById('printForm');

        estimateBtn.addEventListener('click', async function () {
            const fileUpload = document.getElementById('fileUpload').files[0];
            const printType = document.getElementById('printType').value;

            // Validation
            if (!fileUpload) {
                alert("Please upload a file!");
                return;
            }

            // File type validation
            const validTypes = ["application/pdf", "application/vnd.openxmlformats-officedocument.wordprocessingml.document", "image/jpeg", "image/png"];
            if (!validTypes.includes(fileUpload.type)) {
                alert("Unsupported file type. Please upload a PDF, Word, or image file.");
                return;
            }

            // Determine page count
            let pageCount = 0;

            if (fileUpload.type === "application/pdf") {
                pageCount = await getPdfPageCount(fileUpload);
            } else if (fileUpload.type === "application/vnd.openxmlformats-officedocument.wordprocessingml.document") {
                pageCount = 10; // Placeholder for DOCX files
            } else if (fileUpload.type.startsWith("image/")) {
                pageCount = 1;
            }

            if (pageCount === 0) {
                alert("Failed to determine page count. Please try again.");
                return;
            }

            // Calculate estimated cost
            const costPerPage = (printType === 'bw') ? 3 : 5;
            const estimatedCost = pageCount * costPerPage;

            // Update hidden fields
            document.getElementById('pageCount').value = pageCount;
            document.getElementById('estimatedCost').value = estimatedCost;

            // Display estimation
            const resultDiv = document.getElementById('estimateResult');
            resultDiv.innerHTML = `
                <p><strong>Number of Pages:</strong> ${pageCount}</p>
                <p><strong>Print Type:</strong> ${printType === 'bw' ? 'Black & White' : 'Color'}</p>
                <p><strong>Estimated Price:</strong> <span>${estimatedCost} INR</span></p>
            `;
        });

        async function getPdfPageCount(pdfFile) {
            const fileReader = new FileReader();
            return new Promise((resolve, reject) => {
                fileReader.onload = async function () {
                    const pdfData = new Uint8Array(fileReader.result);
                    try {
                        const pdf = await pdfjsLib.getDocument({ data: pdfData }).promise;
                        resolve(pdf.numPages);
                    } catch (error) {
                        reject(error);
                    }
                };
                fileReader.onerror = function () {
                    reject(fileReader.error);
                };
                fileReader.readAsArrayBuffer(pdfFile);
            });
        }
    });
</script>

    <script src="scripts.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

</body>
</html>
